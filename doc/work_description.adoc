**Принцип работы мультиплексора APB_MUX**

Мультиплексор APB_MUX предназначен для арбитража доступа к одному ведомому устройству (slave) от нескольких ведущих устройств (masters) через интерфейс APB4.

**Арбитраж Round-Robin** реализован с использованием циклического сдвига и указателя `ptr`. При одновременных запросах от нескольких мастеров (сигналы `PSEL_s`) арбитр выполняет правосторонний циклический сдвиг массива запросов относительно текущего значения указателя, затем применяет алгоритм фиксированного приоритета к сдвинутому массиву для выбора одного мастера, и выполняет обратный левосторонний сдвиг полученного разрешения. После каждой выданной транзакции указатель `ptr` устанавливается на следующий за текущим мастером, обеспечивая циклическую очередность доступа.

**Конечный автомат управления** с состояниями `IDLE`, `SETUP` и `ACCESS` формирует строгие временные диаграммы протокола APB. В состоянии `IDLE` арбитр выбирает следующего мастера при наличии запросов. В состоянии `SETUP` активируется сигнал `PSEL_m` для выбранного мастера. В состоянии `ACCESS` активируется `PENABLE_m`, а завершение транзакции происходит по сигналу `PREADY_m` от slave-устройства.

**Мультиплексор сигналов** направляет к slave-устройству адрес, данные и управляющие сигналы только от текущего выбранного мастера, определяемого сигналом `current_master`. **Демультиплексор ответов** маршрутизирует данные и статусные сигналы (`PRDATA_m`, `PREADY_m`, `PSLVERR_m`) исключительно активному мастеру, в то время как остальные мастера получают нулевые ответы.

Смена активного мастера происходит при переходе из состояния `IDLE` в `SETUP`, что обеспечивает атомарность выполнения транзакций и предотвращает конфликты доступа к шине.